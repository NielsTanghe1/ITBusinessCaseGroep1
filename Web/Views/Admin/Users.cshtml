@* Change CoffeeUser to CoffeeUserDTO *@
@model List<(CoffeeUserDTO user, System.Collections.Generic.IList<string> roles)>

@{
	ViewData["Title"] = "Users";
}

<div class="admin-header mb-3 d-flex align-items-center justify-content-between">
	<div>
		<h2 class="mb-1">Users</h2>
		<div class="text-muted">Beheer accounts en rollen.</div>
	</div>
	<div class="d-flex gap-2">
		<a class="btn btn-primary" asp-action="CreateUser">+ Nieuwe user</a>
		<a class="btn btn-outline-secondary" asp-action="Index">Dashboard</a>
	</div>
</div>

<div class="card">
	<div class="card-body">
		<div class="table-responsive">
			<table class="table table-striped align-middle mb-0">
				<thead>
					<tr>
						<th>Email</th>
						<th>Rollen</th>
						<th class="text-end">Acties</th>
					</tr>
				</thead>
				<tbody>
					@foreach (var item in Model)
					{
						<tr>
							<td>
								<div class="fw-semibold">@item.user.Email</div>
								<div class="text-muted small">Id: @item.user.Id</div>
								@* Optional: Display GlobalId for debugging *@
								<div class="text-muted small" style="font-size: 0.7em">GID: @item.user.GlobalId</div>
							</td>
							<td>
								@if (item.roles != null && item.roles.Count > 0)
								{
									foreach (var r in item.roles)
									{
										var cls = r == "Admin" ? "bg-danger" : "bg-secondary";
										<span class="badge @cls me-1">@r</span>
									}
								}
								else
								{
									<span class="text-muted">Geen rollen</span>
								}
							</td>

							<td class="text-end">
								<div class="d-flex flex-wrap justify-content-end gap-2">
									<form asp-action="AddRoleToUser" method="post" class="d-flex gap-1 admin-inline-form">
										<input type="hidden" name="userId" value="@item.user.Id" />
										<input class="form-control form-control-sm" name="roleName" placeholder="Role (bv Admin)" />
										<button class="btn btn-success btn-sm" type="submit">Add</button>
									</form>

									<form asp-action="RemoveRoleFromUser" method="post" class="d-flex gap-1 admin-inline-form">
										<input type="hidden" name="userId" value="@item.user.Id" />
										<input class="form-control form-control-sm" name="roleName" placeholder="Role" />
										<button class="btn btn-warning btn-sm" type="submit">Remove</button>
									</form>

									<form asp-action="DeleteUser" method="post" onsubmit="return confirm('Ben je zeker dat je deze user wil verwijderen?');">
										<input type="hidden" name="id" value="@item.user.Id" />
										<button class="btn btn-outline-danger btn-sm" type="submit">Delete</button>
									</form>
								</div>
							</td>
						</tr>
					}
				</tbody>
			</table>
		</div>
	</div>
</div>