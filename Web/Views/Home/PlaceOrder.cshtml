@{
	ViewData["Title"] = "Order Your Brew";
}

<div class="container py-5">
	<div class="row justify-content-center">
		<div class="col-lg-10">
			<div class="card border-0 shadow-lg overflow-hidden">
				<div class="row g-0">
					<div class="col-md-4 bg-dark text-white p-5 d-none d-md-flex flex-column justify-content-center section-background">
						<h2 class="display-6 fw-bold mb-4">Freshly Roasted</h2>
						<p class="lead">Your order is published instantly to our roasting queue via RabbitMQ.</p>
						<div class="mt-4">
							<div class="d-flex align-items-center mb-3">
								<span class="badge bg-warning text-dark me-3">1</span>
								<span class="fw-bold">Select your favorite beans</span>
							</div>
							<div class="d-flex align-items-center mb-3">
								<span class="badge bg-warning text-dark me-3">2</span>
								<span class="fw-bold">Enter delivery details</span>
							</div>
							<div class="d-flex align-items-center">
								<span class="badge bg-warning text-dark me-3">3</span>
								<span class="fw-bold">Enjoy your coffee</span>
							</div>
						</div>
					</div>

					<div class="col-md-8 p-4 p-lg-5 bg-white">
						<div class="text-center mb-5">
							<h2 class="fw-bold headline-accent">Complete Your Order</h2>
							<p class="text-muted">Fill in the details below to trigger our automated workflow.</p>
						</div>

						<form id="orderForm" class="needs-validation">
							<div class="mb-5">
								<h5 class="section-header fw-bold">
									<i class="bi bi-cup-hot-fill me-2"></i>Product Details
								</h5>
								<div class="row g-3">
									<div class="col-md-7">
										<label class="form-label">Coffee Blend / Product</label>
										<input type="text" class="form-control" name="productName" placeholder="e.g. Arabica Dark Roast" required>
									</div>
									<div class="col-md-5">
										<label class="form-label">Category</label>
										<select class="form-select" name="productType">
											<option value="Whole Bean">Whole Bean</option>
											<option value="Ground">Ground</option>
											<option value="Espresso">Espresso</option>
										</select>
									</div>
									<div class="col-md-6">
										<label class="form-label">Price (€)</label>
										<input type="number" step="0.01" class="form-control" name="price" placeholder="0.00" required>
									</div>
									<div class="col-md-6">
										<label class="form-label">Quantity</label>
										<input type="number" class="form-control" name="quantity" value="1" min="1" required>
									</div>
								</div>
							</div>

							<div class="mb-5">
								<h5 class="section-header fw-bold">
									<i class="bi bi-person-fill me-2"></i>Customer Information
								</h5>
								<div class="row g-3">
									<div class="col-md-6">
										<label class="form-label">First Name</label>
										<input type="text" class="form-control" name="firstName" placeholder="John" required>
									</div>
									<div class="col-md-6">
										<label class="form-label">Last Name</label>
										<input type="text" class="form-control" name="lastName" placeholder="Doe" required>
									</div>
									<div class="col-12">
										<label class="form-label">Email Address</label>
										<input type="email" class="form-control" name="email" placeholder="dev@example.com" required>
									</div>
								</div>
							</div>

							<div class="mb-5">
								<h5 class="section-header fw-bold">
									<i class="bi bi-geo-alt-fill me-2"></i>Shipping Address
								</h5>
								<div class="row g-3">
									<div class="col-md-9">
										<label class="form-label">Street</label>
										<input type="text" class="form-control" name="street" placeholder="Rue de la Loi" required>
									</div>
									<div class="col-md-3">
										<label class="form-label">Box</label>
										<input type="text" class="form-control" name="postbus" placeholder="4B">
									</div>
									<div class="col-md-6">
										<label class="form-label">City</label>
										<input type="text" class="form-control" name="city" placeholder="Brussels" required>
									</div>
									<div class="col-md-3">
										<label class="form-label">Postcode</label>
										<input type="number" class="form-control" name="postcode" placeholder="1000" required>
									</div>
									<div class="col-md-3">
										<label class="form-label">Country</label>
										<input type="text" class="form-control" name="country" value="Belgium" required>
									</div>
								</div>
							</div>

							<div class="mb-5 p-4 rounded shadow-sm card-surface">
								<h5 class="section-header fw-bold">
									<i class="bi bi-credit-card-fill me-2"></i>Payment Verification
								</h5>
								<div class="row g-3">
									<div class="col-md-8">
										<label class="form-label">Card Number</label>
										<input type="text" class="form-control card-outline" name="cardnumber" placeholder="XXXX XXXX XXXX XXXX" required>
									</div>
									<div class="col-md-4">
										<label class="form-label">CVV</label>
										<input type="number" class="form-control card-outline" name="cvv" placeholder="123" required>
									</div>
								</div>
							</div>

							<button type="submit" class="btn btn-order btn-lg w-100 shadow fw-bold text-white py-3">
								<i class="bi bi-send-check-fill me-2"></i> Confirm and Place Order
							</button>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

@section Scripts {
	<script>
		document.getElementById('orderForm').addEventListener('submit', async (e) => {
			 e.preventDefault();

			 const formData = new FormData(e.target);
			 const data = Object.fromEntries(formData.entries());

			 data.price = parseFloat(data.price) || 0;
			 data.quantity = parseInt(data.quantity) || 0;
			 data.postcode = parseInt(data.postcode) || 0;
			 data.cvv = parseInt(data.cvv) || 0;

			 try {
				  const response = await fetch('/api/Order', {
						method: 'POST',
						headers: { 'Content-Type': 'application/json' },
						body: JSON.stringify(data)
				  });

				  if (response.ok) {
						alert('Success! Your brew request has been sent to RabbitMQ.');
						e.target.reset();
				  } else {
						const errorMsg = await response.text();
						alert('Error: ' + (errorMsg || response.statusText));
				  }
			 } catch (err) {
				  alert('Connection failed. Please check if your API and RabbitMQ are running.');
			 }
		});
	</script>
}