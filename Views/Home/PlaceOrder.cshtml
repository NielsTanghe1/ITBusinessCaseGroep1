@{
    ViewData["Title"] = "Place New Order";
}

<div class="container mt-5">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h3 class="mb-0">Place New Order</h3>
        </div>
        <div class="card-body">
            <form id="orderForm">
                <div class="row g-3">
                    <h5 class="border-bottom pb-2">Product Details</h5>
                    <div class="col-md-6">
                        <label class="form-label">Product Name</label>
                        <input type="text" class="form-control" name="productName" required>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Type</label>
                        <select class="form-select" name="productType">
                            <option value="Electronics">Electronics</option>
                            <option value="Software">Software</option>
                            <option value="Hardware">Hardware</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Quantity</label>
                        <input type="number" class="form-control" name="quantity" value="1" min="1" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Price</label>
                        <input type="number" step="0.01" class="form-control" name="price" required>
                    </div>

                    <h5 class="border-bottom pb-2 mt-4">Customer Details</h5>
                    <div class="col-md-4">
                        <label class="form-label">First Name</label>
                        <input type="text" class="form-control" name="firstName" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Last Name</label>
                        <input type="text" class="form-control" name="lastName" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" name="email" required>
                    </div>

                    <h5 class="border-bottom pb-2 mt-4">Shipping Address</h5>
                    <div class="col-md-6">
                        <label class="form-label">Street</label>
                        <input type="text" class="form-control" name="street" required>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Postbus</label>
                        <input type="text" class="form-control" name="postbus">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">City</label>
                        <input type="text" class="form-control" name="city" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Postcode</label>
                        <input type="number" class="form-control" name="postcode" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Country</label>
                        <input type="text" class="form-control" name="country" required>
                    </div>

                    <h5 class="border-bottom pb-2 mt-4">Payment Information</h5>
                    <div class="col-md-8">
                        <label class="form-label">Card Number</label>
                        <input type="text" class="form-control" name="cardnumber" placeholder="1234..." required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">CVV</label>
                        <input type="number" class="form-control" name="cvv" required>
                    </div>
                </div>

                <div class="mt-4">
                    <button type="submit" class="btn btn-success btn-lg w-100">Submit Order</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.getElementById('orderForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            // Ensure numbers are sent as numbers, not strings
            data.price = parseFloat(data.price);
            data.quantity = parseInt(data.quantity);
            data.postcode = parseInt(data.postcode);
            data.cvv = parseInt(data.cvv);

            try {
                const response = await fetch('/api/Order', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    alert('Order sent to RabbitMQ successfully!');
                    e.target.reset();
                } else {
                    alert('Error sending order: ' + response.statusText);
                }
            } catch (err) {
                alert('Connection error: ' + err.message);
            }
        });
    </script>
}